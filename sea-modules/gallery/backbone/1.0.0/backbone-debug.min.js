define("gallery/backbone/1.0.0/backbone-debug",["gallery/underscore/1.4.4/underscore","$"],function(e,t){var i=this._,s=this.jQuery;this._=e("gallery/underscore/1.4.4/underscore"),this.jQuery=e("$"),function(){var i,s=this,n=s.Backbone,a=[],r=a.push,o=a.slice,l=a.splice;i=t!==void 0?t:s.Backbone={},i.VERSION="1.0.0";var c=s._;c||void 0===e||(c=e("gallery/underscore/1.4.4/underscore")),i.$=s.jQuery||s.Zepto||s.ender||s.$,i.noConflict=function(){return s.Backbone=n,this},i.emulateHTTP=!1,i.emulateJSON=!1;var d=i.Events={on:function(e,t,i){if(!p(this,"on",e,[t,i])||!t)return this;this._events||(this._events={});var s=this._events[e]||(this._events[e]=[]);return s.push({callback:t,context:i,ctx:i||this}),this},once:function(e,t,i){if(!p(this,"once",e,[t,i])||!t)return this;var s=this,n=c.once(function(){s.off(e,n),t.apply(this,arguments)});return n._callback=t,this.on(e,n,i)},off:function(e,t,i){var s,n,a,r,o,l,d,u;if(!this._events||!p(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events={},this;for(r=e?[e]:c.keys(this._events),o=0,l=r.length;l>o;o++)if(e=r[o],a=this._events[e]){if(this._events[e]=s=[],t||i)for(d=0,u=a.length;u>d;d++)n=a[d],(t&&t!==n.callback&&t!==n.callback._callback||i&&i!==n.context)&&s.push(n);s.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=o.call(arguments,1);if(!p(this,"trigger",e,t))return this;var i=this._events[e],s=this._events.all;return i&&h(i,t),s&&h(s,arguments),this},stopListening:function(e,t,i){var s=this._listeners;if(!s)return this;var n=!t&&!i;"object"==typeof t&&(i=this),e&&((s={})[e._listenerId]=e);for(var a in s)s[a].off(t,i,this),n&&delete this._listeners[a];return this}},u=/\s+/,p=function(e,t,i,s){if(!i)return!0;if("object"==typeof i){for(var n in i)e[t].apply(e,[n,i[n]].concat(s));return!1}if(u.test(i)){for(var a=i.split(u),r=0,o=a.length;o>r;r++)e[t].apply(e,[a[r]].concat(s));return!1}return!0},h=function(e,t){var i,s=-1,n=e.length,a=t[0],r=t[1],o=t[2];switch(t.length){case 0:for(;n>++s;)(i=e[s]).callback.call(i.ctx);return;case 1:for(;n>++s;)(i=e[s]).callback.call(i.ctx,a);return;case 2:for(;n>++s;)(i=e[s]).callback.call(i.ctx,a,r);return;case 3:for(;n>++s;)(i=e[s]).callback.call(i.ctx,a,r,o);return;default:for(;n>++s;)(i=e[s]).callback.apply(i.ctx,t)}},f={listenTo:"on",listenToOnce:"once"};c.each(f,function(e,t){d[t]=function(t,i,s){var n=this._listeners||(this._listeners={}),a=t._listenerId||(t._listenerId=c.uniqueId("l"));return n[a]=t,"object"==typeof i&&(s=this),t[e](i,s,this),this}}),d.bind=d.on,d.unbind=d.off,c.extend(i,d);var v=i.Model=function(e,t){var i,s=e||{};t||(t={}),this.cid=c.uniqueId("c"),this.attributes={},c.extend(this,c.pick(t,g)),t.parse&&(s=this.parse(s,t)||{}),(i=c.result(this,"defaults"))&&(s=c.defaults({},s,i)),this.set(s,t),this.changed={},this.initialize.apply(this,arguments)},g=["url","urlRoot","collection"];c.extend(v.prototype,d,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return c.clone(this.attributes)},sync:function(){return i.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return c.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var s,n,a,r,o,l,d,u;if(null==e)return this;if("object"==typeof e?(n=e,i=t):(n={})[e]=t,i||(i={}),!this._validate(n,i))return!1;a=i.unset,o=i.silent,r=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=c.clone(this.attributes),this.changed={}),u=this.attributes,d=this._previousAttributes,this.idAttribute in n&&(this.id=n[this.idAttribute]);for(s in n)t=n[s],c.isEqual(u[s],t)||r.push(s),c.isEqual(d[s],t)?delete this.changed[s]:this.changed[s]=t,a?delete u[s]:u[s]=t;if(!o){r.length&&(this._pending=!0);for(var p=0,h=r.length;h>p;p++)this.trigger("change:"+r[p],this,u[r[p]],i)}if(l)return this;if(!o)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,c.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,c.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!c.isEmpty(this.changed):c.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?c.clone(this.changed):!1;var t,i=!1,s=this._changing?this._previousAttributes:this.attributes;for(var n in e)c.isEqual(s[n],t=e[n])||((i||(i={}))[n]=t);return i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(e){e=e?c.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,i=e.success;return e.success=function(s){return t.set(t.parse(s,e),e)?(i&&i(t,s,e),t.trigger("sync",t,s,e),void 0):!1},W(this,e),this.sync("read",this,e)},save:function(e,t,i){var s,n,a,r=this.attributes;if(null==e||"object"==typeof e?(s=e,i=t):(s={})[e]=t,!(!s||i&&i.wait||this.set(s,i)))return!1;if(i=c.extend({validate:!0},i),!this._validate(s,i))return!1;s&&i.wait&&(this.attributes=c.extend({},r,s)),void 0===i.parse&&(i.parse=!0);var o=this,l=i.success;return i.success=function(e){o.attributes=r;var t=o.parse(e,i);return i.wait&&(t=c.extend(s||{},t)),c.isObject(t)&&!o.set(t,i)?!1:(l&&l(o,e,i),o.trigger("sync",o,e,i),void 0)},W(this,i),n=this.isNew()?"create":i.patch?"patch":"update","patch"===n&&(i.attrs=s),a=this.sync(n,this,i),s&&i.wait&&(this.attributes=r),a},destroy:function(e){e=e?c.clone(e):{};var t=this,i=e.success,s=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(n){(e.wait||t.isNew())&&s(),i&&i(t,n,e),t.isNew()||t.trigger("sync",t,n,e)},this.isNew())return e.success(),!1;W(this,e);var n=this.sync("delete",this,e);return e.wait||s(),n},url:function(){var e=c.result(this,"urlRoot")||c.result(this.collection,"url")||Y();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},c.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=c.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return i?(this.trigger("invalid",this,i,c.extend(t||{},{validationError:i})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];c.each(m,function(e){v.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.attributes),c[e].apply(c,t)}});var y=i.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,c.extend({silent:!0},t))},b={add:!0,remove:!0,merge:!0},k={add:!0,merge:!1,remove:!1};c.extend(y.prototype,d,{model:v,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return i.sync.apply(this,arguments)},add:function(e,t){return this.set(e,c.defaults(t||{},k))},remove:function(e,t){e=c.isArray(e)?e.slice():[e],t||(t={});var i,s,n,a;for(i=0,s=e.length;s>i;i++)a=this.get(e[i]),a&&(delete this._byId[a.id],delete this._byId[a.cid],n=this.indexOf(a),this.models.splice(n,1),this.length--,t.silent||(t.index=n,a.trigger("remove",a,this,t)),this._removeReference(a));return this},set:function(e,t){t=c.defaults(t||{},b),t.parse&&(e=this.parse(e,t)),c.isArray(e)||(e=e?[e]:[]);var i,s,n,a,o,d=t.at,u=this.comparator&&null==d&&t.sort!==!1,p=c.isString(this.comparator)?this.comparator:null,h=[],f=[],v={};for(i=0,s=e.length;s>i;i++)(n=this._prepareModel(e[i],t))&&((a=this.get(n))?(t.remove&&(v[a.cid]=!0),t.merge&&(a.set(n.attributes,t),u&&!o&&a.hasChanged(p)&&(o=!0))):t.add&&(h.push(n),n.on("all",this._onModelEvent,this),this._byId[n.cid]=n,null!=n.id&&(this._byId[n.id]=n)));if(t.remove){for(i=0,s=this.length;s>i;++i)v[(n=this.models[i]).cid]||f.push(n);f.length&&this.remove(f,t)}if(h.length&&(u&&(o=!0),this.length+=h.length,null!=d?l.apply(this.models,[d,0].concat(h)):r.apply(this.models,h)),o&&this.sort({silent:!0}),t.silent)return this;for(i=0,s=h.length;s>i;i++)(n=h[i]).trigger("add",n,this,t);return o&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var i=0,s=this.models.length;s>i;i++)this._removeReference(this.models[i]);return t.previousModels=this.models,this._reset(),this.add(e,c.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,c.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,c.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return c.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw Error("Cannot sort a set without a comparator");return e||(e={}),c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,i){t||(t=this.comparator);var s=c.isFunction(t)?t:function(e){return e.get(t)};return c.sortedIndex(this.models,e,s,i)},pluck:function(e){return c.invoke(this.models,"get",e)},fetch:function(e){e=e?c.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,i=this;return e.success=function(s){var n=e.reset?"reset":"set";i[n](s,e),t&&t(i,s,e),i.trigger("sync",i,s,e)},W(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?c.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var i=this,s=t.success;return t.success=function(n){t.wait&&i.add(e,t),s&&s(e,n,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof v)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var i=new this.model(e,t);return i._validate(e,t)?i:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,s){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,s),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var w=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];c.each(w,function(e){y.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.models),c[e].apply(c,t)}});var $=["groupBy","countBy","sortBy"];c.each($,function(e){y.prototype[e]=function(t,i){var s=c.isFunction(t)?t:function(e){return e.get(t)};return c[e](this.models,s,i)}});var A=i.View=function(e){this.cid=c.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,N=["model","collection","el","id","attributes","className","tagName","events"];c.extend(A.prototype,d,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof i.$?e:i.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=c.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var i=e[t];if(c.isFunction(i)||(i=this[e[t]]),i){var s=t.match(S),n=s[1],a=s[2];i=c.bind(i,this),n+=".delegateEvents"+this.cid,""===a?this.$el.on(n,i):this.$el.on(n,a,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=c.extend({},c.result(this,"options"),e)),c.extend(this,c.pick(e,N)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{var e=c.extend({},c.result(this,"attributes"));this.id&&(e.id=c.result(this,"id")),this.className&&(e["class"]=c.result(this,"className"));var t=i.$("<"+c.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}}}),i.sync=function(e,t,s){var n=x[e];c.defaults(s||(s={}),{emulateHTTP:i.emulateHTTP,emulateJSON:i.emulateJSON});var a={type:n,dataType:"json"};if(s.url||(a.url=c.result(t,"url")||Y()),null!=s.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(s.attrs||t.toJSON(s))),s.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),s.emulateHTTP&&("PUT"===n||"DELETE"===n||"PATCH"===n)){a.type="POST",s.emulateJSON&&(a.data._method=n);var r=s.beforeSend;s.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",n),r?r.apply(this,arguments):void 0}}"GET"===a.type||s.emulateJSON||(a.processData=!1),"PATCH"!==a.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var o=s.xhr=i.ajax(c.extend(a,s));return t.trigger("request",t,o,s),o};var x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};i.ajax=function(){return i.$.ajax.apply(i.$,arguments)};var C=i.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},O=/\((.*?)\)/g,T=/(\(\?)?:\w+/g,B=/\*\w+/g,_=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(C.prototype,d,{initialize:function(){},route:function(e,t,s){c.isRegExp(e)||(e=this._routeToRegExp(e)),c.isFunction(t)&&(s=t,t=""),s||(s=this[t]);var n=this;return i.history.route(e,function(a){var r=n._extractParameters(e,a);s&&s.apply(n,r),n.trigger.apply(n,["route:"+t].concat(r)),n.trigger("route",t,r),i.history.trigger("route",n,t,r)}),this},navigate:function(e,t){return i.history.navigate(e,t),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var e,t=c.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(_,"\\$&").replace(O,"(?:$1)?").replace(T,function(e,t){return t?e:"([^/]+)"}).replace(B,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return c.map(i,function(e){return e?decodeURIComponent(e):null})}});var D=i.History=function(){this.handlers=[],c.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},q=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,V=/msie [\w.]+/,L=/\/$/;D.started=!1,c.extend(D.prototype,d,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var i=this.root.replace(L,"");e.indexOf(i)||(e=e.substr(i.length))}else e=this.getHash();return e.replace(q,"")},start:function(e){if(D.started)throw Error("Backbone.history has already been started");D.started=!0,this.options=c.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),s=document.documentMode,n=V.exec(navigator.userAgent.toLowerCase())&&(!s||7>=s);this.root=("/"+this.root+"/").replace(I,"/"),n&&this._wantsHashChange&&(this.iframe=i.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?i.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!n?i.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var a=this.location,r=a.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!r?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&r&&a.hash&&(this.fragment=this.getHash().replace(q,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){i.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),D.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(e){var t=this.fragment=this.getFragment(e),i=c.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0});return i},navigate:function(e,t){if(!D.started)return!1;if(t&&t!==!0||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var i=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,i){if(i){var s=e.href.replace(/(javascript:|#).*$/,"");e.replace(s+"#"+t)}else e.hash="#"+t}}),i.history=new D;var j=function(e,t){var i,s=this;i=e&&c.has(e,"constructor")?e.constructor:function(){return s.apply(this,arguments)},c.extend(i,s,t);var n=function(){this.constructor=i};return n.prototype=s.prototype,i.prototype=new n,e&&c.extend(i.prototype,e),i.__super__=s.prototype,i};v.extend=y.extend=C.extend=A.extend=D.extend=j;var Y=function(){throw Error('A "url" property or function must be specified')},W=function(e,t){var i=t.error;t.error=function(s){i&&i(e,s,t),e.trigger("error",e,s,t)}}}.call(this),this._=i,this.jQuery=s});