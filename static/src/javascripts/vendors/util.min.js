define(function(t,e,i){function a(t,e){if(e=e||"string","string"!=typeof e)throw Error("type must be string");return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()===e.toLowerCase()}var n=t("jquery"),r=t("underscore"),o=[40,60,80,100,120,160,180,200,240,250,300,310,320,360,400,460,600],s=Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"),h=304,l={};l.TPL={templates:{},loadTemplates:function(t,e){if(a(t,"string")&&(t=[t]),!a(t,"array"))throw Error("templateName must be array or string");var i=this,r=t.length,o=function(a){var s=t[a];void 0===i.templates[s]?n.get("./static/src/javascripts/tpls/"+s+".html",function(t){i.templates[s]=t,r>++a?o(a):e()}):r>++a?o(a):e()};o(0)},get:function(t){return this.templates[t]}},l.WaterFall=function(t){this.col=t,this.water=[],this.init()},l.WaterFall.prototype.init=function(){for(var t=this.col,e=0;t>e;e++)this.water[e]=0},l.WaterFall.prototype.getMinIndex=function(){return r.indexOf(this.water,r.min(this.water))},l.WaterFall.prototype.getMaxIndex=function(){return r.indexOf(this.water,r.max(this.water))},l.WaterFall.prototype.pushItem=function(t){var e=this;return e.water[e.getMinIndex()]+=t,e.water},l.WaterFall.prototype.getParam=function(){return{col:this.col,water:this.water}},l.WaterFall.prototype.makeColHtml=function(){for(var t="",e=0;this.col>e;e++){var i="waterCol";0===e?i+=" firstCol":e===this.col-1&&(i+=" lastedCol"),t+='<div class="'+i+'"></div>'}return t},l.Date={getEnglishMonth:function(t){return s[t]},getDate:function(t,e){t=t||"/",e=e||0;var i=(new Date).getTime();return i=new Date(i+1e3*60*60*24*e),i.getFullYear()+t+(1+i.getMonth())+t+i.getDate()},translateIOSDate:function(t){return t.substr(0,t.indexOf("T")).split("-").join("/")}},l.TRANSFORM={translate3d:function(t,e,i){t=n(t),i=i||0,e=n.extend({x:0,y:0,z:0},e);var a=t[0].style;a&&(a.MozTransitionDuration=a.msTransitionDuration=a.OTransitionDuration=a.transitionDuration=i+"ms",a.webkitTransform="translate("+e.x+"px,"+e.y+"px)"+"translateZ("+e.z+"px)",a.msTransform=a.MozTransform=a.OTransform="translate("+e.x+"px,"+e.y+"px)"+"translateZ("+e.z+"px)")},autoWidth:function(t,e){$jq=n(t);var i=0;if((e===void 0?e="li":"")&&"string"==typeof e){var a=$jq.find(e);a.length&&a.each(function(){i+=n(this).outerWidth()})}else"number"==typeof e&&(i=$jq.parent().width()*e);$jq.width(i)},animateBase:function(t,e){var i={direct:"h",space:5,slideP:5,rangeP:100,marginR:0,subElement:"li",isLimit:!0,cbfList:{start:n.noop,moving:n.noop,end:n.noop}};e.cbfList&&!r.isEmpty(e.cbfList)&&(n.extend(i.cbfList,e.cbfList),delete e.cbfList),n.extend(i,e),this.defaultOptions=i,this.jq=n(t),this.startPage={x:0,y:0},this.deltaPage={x:0,y:0},this.endPage={x:0,y:0},this.isMouseDown=!1,this.rangeStartX=0,this.rangeEndX=0,this.oneSlide=0,this.init()}},l.TRANSFORM.animateBase.prototype={init:function(){this.jq.wrapAll('<div class="animateWrap" style="width:100%;overflow: hidden;"></div>'),this.wrapObj=this.jq.parent(".animateWrap"),this.targetObj=this.jq.find(this.defaultOptions.subElement),this.defaultOptions.isLimit?(this.oneSlide=this.wrapObj.width(),this.rangeEndX=this.oneSlide*(this.targetObj.length-1)):(this.oneSlide=n(this.targetObj[0]).outerWidth(),this.rangeEndX=this.jq.width()-this.wrapObj.width()),this.rangeStartX=this.defaultOptions.rangeP,this.initEvent()},initEvent:function(){var t=this;t.wrapObj.on("vmousedown vmousemove vmouseout vmouseup",this.defaultOptions.subElement,function(e){var i=n(this);switch(e.type){case"vmousedown":t.startMove(e,i);break;case"vmousemove":return t.moving(e,i),!1;case"vmouseout":case"vmousedown":return t.endMove(e,i),!1}})},startMove:function(t,e){this.startPage={x:t.pageX,y:t.pageY},this.deltaPage={x:0,y:0},this.isMouseDown=!0,this.defaultOptions.cbfList.start(e)},moving:function(t,e){if(!this.isMouseDown)return!1;this.deltaPage={x:t.pageX-this.startPage.x,y:t.pageY-this.startPage.y};var i=this.endPage.x+this.deltaPage.x;0===this.endPage.x&&this.deltaPage.x>this.rangeStartX?this.deltaPage.x=i=this.rangeStartX:this.endPage.x===-this.rangeEndX&&this.deltaPage.x<-this.rangeStartX&&(i=this.endPage.x-this.rangeStartX,this.deltaPage.x=-this.rangeStartX),l.TRANSFORM.translate3d(this.jq,{x:i}),this.defaultOptions.cbfList.moving(e)},endMove:function(t,e){var i=this;if(this.defaultOptions.isLimit){var a=this.deltaPage.x;this.deltaPage.y;var n=this.defaultOptions.slideP;a=this.endPage.x=a>0?this.oneSlide*n>a?a:this.endPage.x+this.oneSlide:a>-(this.oneSlide*n)?a:this.endPage.x-this.oneSlide,l.TRANSFORM.translate3d(this.jq,{x:a},500)}else this.endPage.x+=this.deltaPage.x,this.endPage.x>=0?(this.endPage.x=0,l.TRANSFORM.translate3d(this.jq,{x:0},500)):this.endPage.x<=-i.rangeEndX&&(this.endPage.x=-i.rangeEndX,l.TRANSFORM.translate3d(this.jq,{x:-i.rangeEndX},500));this.defaultOptions.cbfList.end(e),this.startPage={x:0,y:0},this.isMouseDown=!1}},l.LOAD={show:function(){n("#gloabLoading").stop(!0,!0).fadeIn()},hide:function(){n("#gloabLoading").stop(!0,!0).fadeOut()}},l.getWaterFalColWidth=function(){return h},l.setWaterFalColWidth=function(t){h=t},l.OS={detect:function(t){var e=this.os={},i=this.browser={},a=t.match(/WebKit\/([\d.]+)/),n=t.match(/(Android)\s+([\d.]+)/),r=t.match(/(iPad).*OS\s([\d_]+)/),o=!r&&t.match(/(iPhone\sOS)\s([\d_]+)/),s=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),h=s&&t.match(/TouchPad/),l=t.match(/Kindle\/([\d.]+)/),d=t.match(/Silk\/([\d._]+)/),c=t.match(/(BlackBerry).*Version\/([\d.]+)/),u=t.match(/(BB10).*Version\/([\d.]+)/),p=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),m=t.match(/PlayBook/),f=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),g=t.match(/Firefox\/([\d.]+)/);return(i.webkit=!!a)&&(i.version=a[1]),n&&(e.android=!0,e.version=n[2]),o&&(e.ios=e.iphone=!0,e.version=o[2].replace(/_/g,".")),r&&(e.ios=e.ipad=!0,e.version=r[2].replace(/_/g,".")),s&&(e.webos=!0,e.version=s[2]),h&&(e.touchpad=!0),c&&(e.blackberry=!0,e.version=c[2]),u&&(e.bb10=!0,e.version=u[2]),p&&(e.rimtabletos=!0,e.version=p[2]),m&&(i.playbook=!0),l&&(e.kindle=!0,e.version=l[1]),d&&(i.silk=!0,i.version=d[1]),!d&&e.android&&t.match(/Kindle Fire/)&&(i.silk=!0),f&&(i.chrome=!0,i.version=f[1]),g&&(i.firefox=!0,i.version=g[1]),e.tablet=!!(r||m||n&&!t.match(/Mobile/)||g&&t.match(/Tablet/)),e.phone=!(e.tablet||!(n||o||s||c||u||f&&t.match(/Android/)||f&&t.match(/CriOS\/([\d.]+)/)||g&&t.match(/Mobile/))),{os:e,browser:i}},oldAndroid:function(){var t=l.OS.detect(navigator.userAgent),e=!1;return t.os.android&&3>parseInt(t.os.version.slice(0,1))&&(e=!0),e}},l.URL={getHash:function(){var t=window.location.hash,e="";return t&&(e=t.slice(1),e=e.split("/")),e}},l.TOOL={getPicSize:function(){for(var t=l.getWaterFalColWidth(),e=o[0],i=1,a=o.length;a>i;i++)if(o[i]>=t){e=o[i];break}return e}},i.exports=l});