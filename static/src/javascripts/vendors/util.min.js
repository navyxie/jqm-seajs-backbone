define(function(t,e,i){function a(t,e){if(e=e||"string","string"!=typeof e)throw Error("type must be string");return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()===e.toLowerCase()}var n=t("jquery"),s=t("underscore"),r=[40,60,80,100,120,160,180,200,240,250,300,310,320,360,400,460,600],o=Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"),d=304,l={};l.TPL={templates:{},loadTemplates:function(t,e){if(a(t,"string")&&(t=[t]),!a(t,"array"))throw Error("templateName must be array or string");var i=this,s=t.length,r=function(a){var o=t[a];void 0===i.templates[o]?n.get("./static/src/javascripts/tpls/"+o+".html",function(t){i.templates[o]=t,s>++a?r(a):e()}):s>++a?r(a):e()};r(0)},get:function(t){return this.templates[t]}},l.WaterFall=function(t){this.col=t,this.water=[],this.init()},l.WaterFall.prototype.init=function(){for(var t=this.col,e=0;t>e;e++)this.water[e]=0},l.WaterFall.prototype.getMinIndex=function(){return s.indexOf(this.water,s.min(this.water))},l.WaterFall.prototype.getMaxIndex=function(){return s.indexOf(this.water,s.max(this.water))},l.WaterFall.prototype.pushItem=function(t){var e=this;return e.water[e.getMinIndex()]+=t,e.water},l.WaterFall.prototype.getParam=function(){return{col:this.col,water:this.water}},l.WaterFall.prototype.makeColHtml=function(){for(var t="",e=0;this.col>e;e++){var i="waterCol";0===e?i+=" firstCol":e===this.col-1&&(i+=" lastedCol"),t+='<div class="'+i+'"></div>'}return t},l.Date={getEnglishMonth:function(t){return o[t]},getDate:function(t,e){t=t||"/",e=e||0;var i=(new Date).getTime();return i=new Date(i+1e3*60*60*24*e),i.getFullYear()+t+(1+i.getMonth())+t+i.getDate()},translateIOSDate:function(t){return t.substr(0,t.indexOf("T")).split("-").join("/")}},l.TRANSFORM={translate3d:function(t,e,i){t=n(t),i=i||0,e=n.extend({x:0,y:0,z:0},e);var a=t[0].style;a&&(a.MozTransitionDuration=a.msTransitionDuration=a.OTransitionDuration=a.transitionDuration=i+"ms",a.webkitTransform="translate("+e.x+"px,"+e.y+"px)"+"translateZ("+e.z+"px)",a.msTransform=a.MozTransform=a.OTransform="translate("+e.x+"px,"+e.y+"px)"+"translateZ("+e.z+"px)")},autoWidth:function(t,e,i,a){$jq=n(t);var s=0;i=i||!1,a=a||0;var r=$jq.parent().width();if((e=e===void 0?"li":e)&&"string"==typeof e){var o=$jq.find(e),d=o.length;d&&o.each(function(t){var e=n(this);i&&(++t===d?e.css({"float":"left",width:r+"px"}):e.css({"float":"left","margin-right":a+"px",width:r+"px"})),s+=e.outerWidth()})}else"number"==typeof e&&(s=r*e);$jq.width(s)},animateBase:function(t,e){var i={direct:"h",space:5,slideP:5,rangeP:100,marginR:0,subElement:"li",isLimit:!0,cbfList:{start:n.noop,moving:n.noop,end:n.noop},index:0};e.cbfList&&!s.isEmpty(e.cbfList)&&(n.extend(i.cbfList,e.cbfList),delete e.cbfList),n.extend(i,e),this.defaultOptions=i,this.jq=n(t),this.startPage={x:0,y:0},this.deltaPage={x:0,y:0},this.endPage={x:0,y:0},this.isMouseDown=!1,this.rangeStartX=0,this.rangeEndX=0,this.oneSlide=0,this.index=this.defaultOptions.index,this.init()}},l.TRANSFORM.animateBase.prototype={init:function(){this.jq.wrapAll('<div class="animateWrap" style="width:100%;overflow: hidden;"></div>'),this.wrapObj=this.jq.parent(".animateWrap"),this.targetObj=this.jq.find(this.defaultOptions.subElement);var t=this.targetObj.length;if(t){if(this.jq.width()<=this.wrapObj.width())return!1;this.index>=t-1&&(this.index=t-1),this.defaultOptions.isLimit?(this.oneSlide=this.wrapObj.width(),this.rangeEndX=this.oneSlide*(t-1)):(this.oneSlide=n(this.targetObj[0]).outerWidth(),this.rangeEndX=this.jq.width()-this.wrapObj.width()),this.rangeStartX=this.defaultOptions.rangeP,this.showItem(this.index),this.initEvent()}},initEvent:function(){var t=this;t.wrapObj.on("vmousedown vmousemove vmouseout vmouseup",this.defaultOptions.subElement,function(e){var i=n(this);switch(e.type){case"vmousedown":t.startMove(e,i);break;case"vmousemove":return t.moving(e,i),!1;case"vmouseout":case"vmousedown":return t.endMove(e,i),!1}})},startMove:function(t,e){var i=this;i.startPage={x:t.pageX,y:t.pageY},i.deltaPage={x:0,y:0},i.isMouseDown=!0,i.defaultOptions.cbfList.start(e,i.index)},moving:function(t,e){var i=this;if(!i.isMouseDown)return!1;i.deltaPage={x:t.pageX-i.startPage.x,y:t.pageY-i.startPage.y};var a=i.endPage.x+i.deltaPage.x;0===i.endPage.x&&i.deltaPage.x>i.rangeStartX?i.deltaPage.x=a=i.rangeStartX:i.endPage.x===-i.rangeEndX&&i.deltaPage.x<-i.rangeStartX&&(a=i.endPage.x-i.rangeStartX,i.deltaPage.x=-i.rangeStartX),l.TRANSFORM.translate3d(i.jq,{x:a}),i.defaultOptions.cbfList.moving(e,i.index)},endMove:function(t,e){var i=this;if(i.defaultOptions.isLimit){var a=i.deltaPage.x;i.deltaPage.y;var n=i.defaultOptions.slideP;a>0?i.oneSlide*n>a?a=i.endPage.x=a:(a=i.endPage.x=i.endPage.x+i.oneSlide,++i.index):a>-(i.oneSlide*n)?a=i.endPage.x=a:(a=i.endPage.x=i.endPage.x-i.oneSlide,--i.index),l.TRANSFORM.translate3d(i.jq,{x:a},500)}else i.endPage.x+=i.deltaPage.x,i.endPage.x>=0?(i.endPage.x=0,l.TRANSFORM.translate3d(i.jq,{x:0},500)):i.endPage.x<=-i.rangeEndX&&(i.endPage.x=-i.rangeEndX,l.TRANSFORM.translate3d(i.jq,{x:-i.rangeEndX},500));i.defaultOptions.cbfList.end(e,i.index),i.startPage={x:0,y:0},i.isMouseDown=!1},showItem:function(t){var e=this;l.TRANSFORM.translate3d(e.jq,{x:-t*e.oneSlide},500)},getIndex:function(){return this.index}},l.LOAD={show:function(){n("#gloabLoading").stop(!0,!0).fadeIn()},hide:function(){n("#gloabLoading").stop(!0,!0).fadeOut()}},l.getWaterFalColWidth=function(){return d},l.setWaterFalColWidth=function(t){d=t},l.OS={detect:function(t){var e=this.os={},i=this.browser={},a=t.match(/WebKit\/([\d.]+)/),n=t.match(/(Android)\s+([\d.]+)/),s=t.match(/(iPad).*OS\s([\d_]+)/),r=!s&&t.match(/(iPhone\sOS)\s([\d_]+)/),o=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),d=o&&t.match(/TouchPad/),l=t.match(/Kindle\/([\d.]+)/),h=t.match(/Silk\/([\d._]+)/),c=t.match(/(BlackBerry).*Version\/([\d.]+)/),u=t.match(/(BB10).*Version\/([\d.]+)/),g=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),f=t.match(/PlayBook/),p=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),m=t.match(/Firefox\/([\d.]+)/);return(i.webkit=!!a)&&(i.version=a[1]),n&&(e.android=!0,e.version=n[2]),r&&(e.ios=e.iphone=!0,e.version=r[2].replace(/_/g,".")),s&&(e.ios=e.ipad=!0,e.version=s[2].replace(/_/g,".")),o&&(e.webos=!0,e.version=o[2]),d&&(e.touchpad=!0),c&&(e.blackberry=!0,e.version=c[2]),u&&(e.bb10=!0,e.version=u[2]),g&&(e.rimtabletos=!0,e.version=g[2]),f&&(i.playbook=!0),l&&(e.kindle=!0,e.version=l[1]),h&&(i.silk=!0,i.version=h[1]),!h&&e.android&&t.match(/Kindle Fire/)&&(i.silk=!0),p&&(i.chrome=!0,i.version=p[1]),m&&(i.firefox=!0,i.version=m[1]),e.tablet=!!(s||f||n&&!t.match(/Mobile/)||m&&t.match(/Tablet/)),e.phone=!(e.tablet||!(n||r||o||c||u||p&&t.match(/Android/)||p&&t.match(/CriOS\/([\d.]+)/)||m&&t.match(/Mobile/))),{os:e,browser:i}},oldAndroid:function(){var t=l.OS.detect(navigator.userAgent),e=!1;return t.os.android&&3>parseInt(t.os.version.slice(0,1))&&(e=!0),e}},l.URL={getHash:function(){var t=window.location.hash,e="";return t&&(e=t.slice(1),e=e.split("/")),e}},l.TOOL={getPicSize:function(){for(var t=l.getWaterFalColWidth(),e=r[0],i=1,a=r.length;a>i;i++)if(r[i]>=t){e=r[i];break}return e},backTop:function(){n("body").animate({scrollTop:0},500)}},i.exports=l});