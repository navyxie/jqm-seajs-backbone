define(function(t,e,i){function a(t,e){if(e=e||"string","string"!=typeof e)throw Error("type must be string");return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()===e.toLowerCase()}var n=t("jquery"),r=t("underscore"),s=[40,60,80,100,120,160,180,200,240,250,300,310,320,360,400,460,600],o=Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Spt","Oct","Nov","Dec"),d=304,l="cbdapp",h=["vmousedown","vmousemove","vmouseup","vmouseout"],g={};g.TPL={templates:{},loadTemplates:function(t,e){if(a(t,"string")&&(t=[t]),!a(t,"array"))throw Error("templateName must be array or string");var i=this,r=t.length,s=function(a){var o=t[a];void 0===i.templates[o]?n.get("./static/src/javascripts/tpls/"+o+".html",function(t){i.templates[o]=t,r>++a?s(a):e()}):r>++a?s(a):e()};s(0)},get:function(t){return this.templates[t]}},g.WaterFall=function(t){this.col=t,this.water=[],this.init()},g.WaterFall.prototype.init=function(){for(var t=this.col,e=0;t>e;e++)this.water[e]=0},g.WaterFall.prototype.getMinIndex=function(){return r.indexOf(this.water,r.min(this.water))},g.WaterFall.prototype.getMaxIndex=function(){return r.indexOf(this.water,r.max(this.water))},g.WaterFall.prototype.pushItem=function(t){var e=this;return e.water[e.getMinIndex()]+=t,e.water},g.WaterFall.prototype.getParam=function(){return{col:this.col,water:this.water}},g.WaterFall.prototype.makeColHtml=function(){for(var t="",e=0;this.col>e;e++){var i="waterCol";0===e?i+=" firstCol":e===this.col-1&&(i+=" lastedCol"),t+='<div class="'+i+'"></div>'}return t},g.Date={getEnglishMonth:function(t){return o[t]},getDate:function(t,e){t=t||"/",e=e||0;var i=(new Date).getTime();return i=new Date(i+1e3*60*60*24*e),i.getFullYear()+t+(1+i.getMonth())+t+i.getDate()},translateIOSDate:function(t){return t.substr(0,t.indexOf("T")).split("-").join("/")}},g.TRANSFORM={translate3d:function(t,e,i){t=n(t),i=i||0,e=n.extend({x:0,y:0,z:0},e);var a=t[0].style;a&&(a.MozTransitionDuration=a.msTransitionDuration=a.OTransitionDuration=a.transitionDuration=i+"ms",a.webkitTransform="translate("+e.x+"px,"+e.y+"px)"+"translateZ("+e.z+"px)",a.msTransform=a.MozTransform=a.OTransform="translate("+e.x+"px,"+e.y+"px)"+"translateZ("+e.z+"px)")},autoWidth:function(t,e,i,a){$jq=n(t);var r=0;i=i||!1,a=a||0;var s=$jq.parent().width();if((e=e===void 0?"li":e)&&"string"==typeof e){var o=$jq.find(e),d=o.length;d&&o.each(function(t){var e=n(this);i&&(++t===d?e.css({"float":"left",width:s+"px"}):e.css({"float":"left","margin-right":a+"px",width:s+"px"})),r+=e.outerWidth(!0)})}else"number"==typeof e&&(r=s*e);$jq.width(r)},animateBase:function(t,e){e=e||{};var i={direct:"h",space:10,slideP:10,rangeP:100,marginR:0,subElement:"li",isLimit:!0,cbfList:{start:n.noop,moving:n.noop,end:n.noop},index:0};e.cbfList&&!r.isEmpty(e.cbfList)&&(n.extend(i.cbfList,e.cbfList),delete e.cbfList),n.extend(i,e),this.defaultOptions=i,this.jq=n(t),this.startPage={x:0,y:0},this.deltaPage={x:0,y:0},this.endPage={x:0,y:0},this.isMouseDown=!1,this.rangeStartX=0,this.rangeEndX=0,this.oneSlide=0,this.index=this.defaultOptions.index,this.preIndex=this.defaultOptions.index,this.setTimeoutFlag=null,this.isScrolling=void 0,this.init()}},g.TRANSFORM.animateBase.prototype={init:function(){this.jq.wrapAll('<div class="animateWrap" style="width:100%;overflow: hidden;"></div>'),this.wrapObj=this.jq.parent(".animateWrap"),this.targetObj=this.jq.find(this.defaultOptions.subElement);var t=this.targetObj.length;if(this.targetObj.len=t,t){if(this.jq.width()<=this.wrapObj.width())return!1;this.index>=t-1&&(this.index=t-1),this.defaultOptions.isLimit?(this.oneSlide=this.wrapObj.width(),this.rangeEndX=this.oneSlide*(t-1)):(this.oneSlide=n(this.targetObj[0]).outerWidth(),this.rangeEndX=this.jq.width()-this.wrapObj.width()),this.rangeStartX=this.defaultOptions.rangeP,this.showItem(this.index),this.initEvent(),this.defaultOptions.isLimit?this.showItem(this.index):this.showNav(this.index)}},initEvent:function(){var t=this;t.wrapObj.on(h.join(" "),this.defaultOptions.subElement,function(e){var i=n(this);switch(e.type){case h[0]:t.startMove(e,i);break;case h[1]:return t.moving(e,i);case h[2]:return t.endMove(e,i)}})},startMove:function(t,e){var i=this;i.startPage={x:t.pageX,y:t.pageY},i.deltaPage={x:0,y:0},i.isMouseDown=!0,i.isScrolling=void 0,i.defaultOptions.cbfList.start(e,i.index)},moving:function(t,e){var i=this,a=!1;if(i.isMouseDown)if(i.deltaPage={x:t.pageX-i.startPage.x,y:t.pageY-i.startPage.y},i.isScrolling===void 0&&(i.isScrolling=!!(i.isScrolling||Math.abs(i.deltaPage.x)<Math.abs(i.deltaPage.y))),!i.isScrolling&&Math.abs(i.deltaPage.x)>i.defaultOptions.space)if(i.defaultOptions.isLimit&&Math.abs(i.deltaPage.y)>Math.abs(i.deltaPage.x))a=!0;else{var n=i.endPage.x+i.deltaPage.x;0===i.endPage.x&&i.deltaPage.x>i.rangeStartX?i.deltaPage.x=n=i.rangeStartX:i.endPage.x===-i.rangeEndX&&i.deltaPage.x<-i.rangeStartX&&(n=i.endPage.x-i.rangeStartX,i.deltaPage.x=-i.rangeStartX),g.TRANSFORM.translate3d(i.jq,{x:n}),i.defaultOptions.cbfList.moving(e,i.index),a=!1}else a=!0;else a=!1;return a},endMove:function(t,e){var i=this,a=!1;if(i.isScrolling)a=!0;else{if(i.defaultOptions.isLimit)if(Math.abs(t.pageY-i.startPage.y)>Math.abs(t.pageX-i.startPage.x))a=!0;else{var n=i.deltaPage.x;i.deltaPage.y;var r=i.defaultOptions.slideP;n>0?r>n?n=i.endPage.x:(n=i.endPage.x=i.endPage.x+i.oneSlide,--i.index):n>-r?n=i.endPage.x:(n=i.endPage.x=i.endPage.x-i.oneSlide,++i.index),n>=0?i.endPage.x=n=i.index=0:-i.rangeEndX>=n&&(i.endPage.x=n=-i.rangeEndX,i.index=this.targetObj.len-1),i.showItem(i.index),a=!1}else i.endPage.x+=i.deltaPage.x,i.endPage.x>=0?(i.endPage.x=0,g.TRANSFORM.translate3d(i.jq,{x:0},500)):i.endPage.x<=-i.rangeEndX&&(i.endPage.x=-i.rangeEndX,g.TRANSFORM.translate3d(i.jq,{x:-i.rangeEndX},500)),a=!1;i.defaultOptions.cbfList.end(e,i.index)}return i.startPage={x:0,y:0},i.isMouseDown=!1,a},showItem:function(t){var e=this;g.TRANSFORM.translate3d(e.jq,{x:-t*e.oneSlide},500),e.endPage={x:-t*e.oneSlide,y:0},e.index=t,e.setTimeoutFlag&&clearTimeout(e.setTimeoutFlag),e.setTimeoutFlag=setTimeout(function(){e.jq.height(e.targetObj.eq(t).outerHeight(!0))},20),e.index!==e.preIndex&&(g.TOOL.backTop(),e.preIndex=e.index)},getIndex:function(){return this.index},showNav:function(t){var e=this;if(!e.defaultOptions.isLimit){for(var i=0,a=0,r=e.wrapObj.width(),s=0;t>=s;s++)i+=n(e.targetObj[s]).outerWidth();i>r&&(a=i-r),e.targetObj.removeClass("selected").eq(t).addClass("selected"),g.TRANSFORM.translate3d(e.jq,{x:-a},500),e.endPage={x:-a,y:0},e.index=t}}},g.LOAD={show:function(){n("#gloabLoading").stop(!0,!0).fadeIn()},hide:function(){n("#gloabLoading").stop(!0,!0).fadeOut()}},g.getWaterFalColWidth=function(){return d},g.setWaterFalColWidth=function(t){d=t},g.OS={detect:function(t){var e=this.os={},i=this.browser={},a=t.match(/WebKit\/([\d.]+)/),n=t.match(/(Android)\s+([\d.]+)/),r=t.match(/(iPad).*OS\s([\d_]+)/),s=!r&&t.match(/(iPhone\sOS)\s([\d_]+)/),o=t.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),d=o&&t.match(/TouchPad/),l=t.match(/Kindle\/([\d.]+)/),h=t.match(/Silk\/([\d._]+)/),g=t.match(/(BlackBerry).*Version\/([\d.]+)/),u=t.match(/(BB10).*Version\/([\d.]+)/),c=t.match(/(RIM\sTablet\sOS)\s([\d.]+)/),f=t.match(/PlayBook/),p=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),m=t.match(/Firefox\/([\d.]+)/);return(i.webkit=!!a)&&(i.version=a[1]),n&&(e.android=!0,e.version=n[2]),s&&(e.ios=e.iphone=!0,e.version=s[2].replace(/_/g,".")),r&&(e.ios=e.ipad=!0,e.version=r[2].replace(/_/g,".")),o&&(e.webos=!0,e.version=o[2]),d&&(e.touchpad=!0),g&&(e.blackberry=!0,e.version=g[2]),u&&(e.bb10=!0,e.version=u[2]),c&&(e.rimtabletos=!0,e.version=c[2]),f&&(i.playbook=!0),l&&(e.kindle=!0,e.version=l[1]),h&&(i.silk=!0,i.version=h[1]),!h&&e.android&&t.match(/Kindle Fire/)&&(i.silk=!0),p&&(i.chrome=!0,i.version=p[1]),m&&(i.firefox=!0,i.version=m[1]),e.tablet=!!(r||f||n&&!t.match(/Mobile/)||m&&t.match(/Tablet/)),e.phone=!(e.tablet||!(n||s||o||g||u||p&&t.match(/Android/)||p&&t.match(/CriOS\/([\d.]+)/)||m&&t.match(/Mobile/))),{os:e,browser:i}},oldAndroid:function(){var t=g.OS.detect(navigator.userAgent),e=!1;return t.os.android&&3>parseInt(t.os.version.slice(0,1))&&(e=!0),e},isMobile:function(){var t=g.OS.detect(navigator.userAgent);return t.os.phone||t.os.tablet}},g.URL={getHash:function(){var t=window.location.hash,e="";return t&&(e=t.slice(1),e=e.split("/")),e}},g.TOOL={getPicSize:function(){for(var t=g.getWaterFalColWidth(),e=s[0],i=1,a=s.length;a>i;i++)if(s[i]>=t){e=s[i];break}return e},backTop:function(){n("body").animate({scrollTop:0},500)}},g.STORE={setItem:function(t,e){window.localStorage.setItem(l+t,JSON.stringify(e))},getItem:function(t){return JSON.parse(window.localStorage.getItem(l+t))},removeItem:function(t){window.localStorage.removeItem(l+t)}},!function(){g.OS.isMobile()}(),i.exports=g});