define(function(e,t,n){var r=e("jqmobile"),i=e("backbone"),s=e("./title"),o=new(e("../collections/title")),u=e("./journal"),a=e("../vendors/util"),f=a.LOAD,l=a.TRANSFORM,c={},h=i.View.extend({initialize:function(){var e=this;o.bind("add",this.addOneNav,this),o.bind("reset",this.addAllNav,this),e.$navContainer=r("#titleNav"),e.$pageList=r("#pageList"),e.fetchTitle()},el:"body",events:{},handlerTitle:function(){var e=this;e.$navLi=e.$navContainer.find(".navLi"),e.$navContainer.on("vclick",".navLi",function(t){var n=r(this);if(n.hasClass("navLi")&&!n.hasClass("selected")){var i=e.$navLi.index(n);e.addSelectedClass(i),e.initJournalModel({_id:o.at(i).toJSON()._id,id:"pageContent"+i,index:i})}})},addSelectedClass:function(e){this.$navLi.removeClass("selected").eq(e).addClass("selected")},render:function(){return this},addOneNav:function(e){this.$navContainer.append((new s({model:e})).render().el),l.autoWidth(this.$navContainer),c[e.get("_id")]={id:null,loaded:!1}},addAllNav:function(){var e=this;o.each(function(){e.addOneNav.apply(e,arguments)})},fetchTitle:function(){var e=this;o.fetch({success:function(t,n,r){e.navAnimate=new l.animateBase(e.$navContainer,{isLimit:!1}),e.handlerTitle(),e.makePageContent(n.length),l.autoWidth(e.$pageList,".pageContent",!0),e.journalAnimate=new l.animateBase(e.$pageList,{cbfList:{end:function(t,n){e.navAnimate.showNav(n),e.initJournalModel({_id:o.at(n).toJSON()._id,id:"pageContent"+n,index:n})}}});var i=o.at(0).toJSON();e.initJournalModel({_id:i._id,id:"pageContent0",index:0})},error:function(){}})},makePageContent:function(e){var t="";for(var n=0;n<e;n++)t+='<li class="pageContent" id="pageContent'+n+'" index='+n+"></li>";this.$pageList.append(t)},initJournalModel:function(e,t){var n=this;t=t||r.noop;if(!c[e._id].id){c[e._id].id=new u({el:"#"+e.id});var i=!1;c[e._id].loaded?n.journalAnimate.showItem(e.index):(c[e._id].loaded=!0,c[e._id].id.fetchData({id:e._id},function(r,i){r?c[e._id].loaded=!1:n.journalAnimate.showItem(e.index),t(r,i)}))}else n.journalAnimate.showItem(e.index);n.$navLi.eq(e.index).addClass("selected")}});n.exports=h})