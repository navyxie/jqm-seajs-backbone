define(function(t,e,i){var a=t("jqmobile"),n=t("backbone"),r=t("./title"),s=new(t("../collections/title")),o=t("./journal"),d=t("../vendors/util");d.LOAD;var l=d.TRANSFORM,h={},u=n.View.extend({initialize:function(){var t=this;s.bind("add",this.addOneNav,this),s.bind("reset",this.addAllNav,this),t.$navContainer=a("#titleNav"),t.$pageList=a("#pageList"),t.fetchTitle()},el:"body",events:{"tap #likeJounalBtn":"likeJournal"},likeJournal:function(t){return a(t.target).toggleClass("unLikeJounalBtn").toggleClass("likedJounalBtn"),!1},handlerTitle:function(){var t=this;t.$navLi=t.$navContainer.find(".navLi"),t.$navContainer.on("vclick",".navLi",function(){var e=a(this);if(e.hasClass("navLi")&&!e.hasClass("selected")){var i=t.$navLi.index(e);t.addSelectedClass(i),t.initJournalModel({_id:s.at(i).toJSON()._id,id:"pageContent"+i,index:i})}})},addSelectedClass:function(t){this.$navLi.removeClass("selected").eq(t).addClass("selected")},render:function(){return this},addOneNav:function(t){this.$navContainer.append(new r({model:t}).render().el),l.autoWidth(this.$navContainer),h[t.get("_id")]={id:null,loaded:!1}},addAllNav:function(){var t=this;s.each(function(){t.addOneNav.apply(t,arguments)})},fetchTitle:function(){var t=this;s.fetch({success:function(e,i){t.navAnimate=new l.animateBase(t.$navContainer,{isLimit:!1}),t.handlerTitle(),t.makePageContent(i.length),l.autoWidth(t.$pageList,".pageContent",!0),t.journalAnimate=new l.animateBase(t.$pageList,{cbfList:{end:function(e,i){t.navAnimate.showNav(i),t.initJournalModel({_id:s.at(i).toJSON()._id,id:"pageContent"+i,index:i})}}});var a=s.at(0).toJSON();t.initJournalModel({_id:a._id,id:"pageContent0",index:0})},error:function(){}})},makePageContent:function(t){for(var e="",i=0;t>i;i++)e+='<li class="pageContent" id="pageContent'+i+'" index='+i+"></li>";this.$pageList.append(e)},initJournalModel:function(t,e){var i=this;e=e||a.noop,h[t._id].id?i.journalAnimate.showItem(t.index):(h[t._id].id=new o({el:"#"+t.id}),h[t._id].loaded?i.journalAnimate.showItem(t.index):(h[t._id].loaded=!0,h[t._id].id.fetchData({id:t._id},function(a,n){a?h[t._id].loaded=!1:i.journalAnimate.showItem(t.index),e(a,n)}))),i.$navLi.eq(t.index).addClass("selected")}});i.exports=u});