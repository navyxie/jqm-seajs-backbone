define(function(t,e,i){var a=t("underscore"),n=t("backbone"),r=t("../vendors/util"),s=t("jquery"),o=2,d=r.WaterFall,l=r.Date,h=r.LOAD,u=!1,g=s(window);g.height(),s("#index").find(".header").height();var c=t("./item"),f=t("../models/journal"),p=r.TPL.get,m=t("../collections/item"),x=n.View.extend({className:"journalView",template:a.template(p.call(r.TPL,"journal")),initialize:function(){var t=this;t.el=s(t.el),t.itemView=c,t.journalModel=new f,t.journalModel.bind("change",this.render,this),t.itemCollection=new m,t.itemCollection.bind("add",t.addOne,t),t.itemCollection.bind("reset",t.addAll,t)},events:{},fetchData:function(t,e){var i=this;h.show(),i.journalModel.fetch({data:t,success:function(){e(null,arguments),h.hide()},error:function(){alert("获取数据失败,请检查网络"),console.log("+++++++++++++++++++"),console.log(window.appConfig.appHost),console.log(JSON.stringify(i.queryObj)),console.log(i.journalModel.url),console.log("------------------"),e({err:"获取数据失败"},arguments),h.hide()}})},render:function(){var t=this,e=t.journalModel.toJSON(),i=e.tle,a=new Date(l.translateIOSDate(e.pubTime)),n=1+a.getMonth(),h=i,g=i,c=i.indexOf("】");return-1!==c&&(h=i.slice(0,c+1),g=i.slice(c+1)),t.el.append(t.template({banner:e.banner,blogId:e.blogId,bTitle:h,sTitle:g,month:n,date:a.getDate()})),t.waterObj=new d(o),t.waterFallContainer=t.el.find(".jContent").append(t.waterObj.makeColHtml()),t.waterFallObj=t.waterFallContainer.find(".waterCol"),u||(u=!0,r.setWaterFalColWidth(s(t.waterFallObj[0]).width())),t.renderItems(e),t},renderItems:function(t){var e=t.items,i=this,n=a.filter(e,function(t){return t.pic_size});i.itemCollection.reset(),i.itemCollection.add(n)},addOne:function(t){var e=this,i=new e.itemView({model:t});s(e.waterFallObj[e.waterObj.getMinIndex()]).append(i.render().el),e.waterObj.pushItem(t.toJSON().pic_size.h)},addAll:function(){var t=this;t.itemCollection.each(function(){t.addOne.apply(t,arguments)})}});i.exports=x});