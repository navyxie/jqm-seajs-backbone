define(function(e,t,n){var i=e("underscore"),a=e("backbone"),o=e("../vendors/util"),r=e("jquery"),s=2,l=o.WaterFall,d=o.Date,c=o.LOAD,h=!1,u=r(window);u.height(),r("#index").find(".header").height();var f=e("./item"),g=e("../models/journal"),v=o.TPL.get,p=e("../collections/item"),m=a.View.extend({className:"journalView",template:i.template(v.call(o.TPL,"journal")),initialize:function(){var e=this;e.el=r(e.el),e.itemView=f,e.journalModel=new g,e.journalModel.bind("change",this.render,this),e.itemCollection=new p,e.itemCollection.bind("add",e.addOne,e),e.itemCollection.bind("reset",e.addAll,e)},events:{},fetchData:function(e,t){var n=this;c.show(),n.journalModel.fetch({data:e,success:function(){t(null,arguments),c.hide()},error:function(){alert("获取数据失败,请检查网络"),console.log("+++++++++++++++++++"),console.log(window.appConfig.appHost),console.log(JSON.stringify(n.queryObj)),console.log(n.journalModel.url),console.log("------------------"),t({err:"获取数据失败"},arguments),c.hide()}})},render:function(){var e=this,t=e.journalModel.toJSON(),n=t.tle,i=new Date(t.pubTime),a=d.getEnglishMonth(i.getMonth()),c=n,u=n,f=n.indexOf("】");return-1!==f&&(c=n.slice(0,f+1),u=n.slice(f+1)),e.el.append(e.template({banner:t.banner,blogId:t.blogId,bTitle:c,sTitle:u,month:a,date:i.getDate()})),e.waterObj=new l(s),e.waterFallContainer=e.el.find(".jContent").append(e.waterObj.makeColHtml()),e.waterFallObj=e.waterFallContainer.find(".waterCol"),h||(h=!0,o.setWaterFalColWidth(r(e.waterFallObj[0]).width())),e.renderItems(t),e},renderItems:function(e){var t=e.items,n=this,a=i.filter(t,function(e){return e.pic_size});n.itemCollection.reset(),n.itemCollection.add(a)},addOne:function(e){var t=this,n=new t.itemView({model:e});r(t.waterFallObj[t.waterObj.getMinIndex()]).append(n.render().el),t.waterObj.pushItem(e.toJSON().pic_size.h)},addAll:function(){var e=this;e.itemCollection.each(function(){e.addOne.apply(e,arguments)})}});n.exports=m});