define(function(e,t,n){var r=e("underscore"),i=e("backbone"),s=e("../vendors/util"),o=e("jquery"),u=2,a=s.WaterFall,f=s.Date,l=s.LOAD,c=!1,h=o(window),p=h.height(),d=o("#index").find(".header").height(),v=e("./item"),m=e("../models/journal"),g=s.TPL.get,y=e("../collections/item"),b=i.View.extend({className:"journalView",template:r.template(g.call(s.TPL,"journal")),initialize:function(){var e=this;e.el=o(e.el),e.itemView=v,e.journalModel=new m,e.journalModel.bind("change",this.render,this),e.itemCollection=new y,e.itemCollection.bind("add",e.addOne,e),e.itemCollection.bind("reset",e.addAll,e)},events:{},fetchData:function(e,t){var n=this;l.show(),n.journalModel.fetch({data:e,success:function(e,n,r){t(null,arguments),l.hide()},error:function(){alert("\u83b7\u53d6\u6570\u636e\u5931\u8d25,\u8bf7\u68c0\u67e5\u7f51\u7edc"),console.log("+++++++++++++++++++"),console.log(window.appConfig.appHost),console.log(JSON.stringify(n.queryObj)),console.log(n.journalModel.url),console.log("------------------"),t({err:"\u83b7\u53d6\u6570\u636e\u5931\u8d25"},arguments),l.hide()}})},render:function(){var e=this,t=e.journalModel.toJSON(),n=t.tle,r=new Date(f.translateIOSDate(t.pubTime)),i=f.getEnglishMonth(r.getMonth()),l=n,h=n,p=n.indexOf("\u3011");return p!==-1&&(l=n.slice(0,p+1),h=n.slice(p+1)),e.el.append(e.template({banner:t.banner,blogId:t.blogId,bTitle:l,sTitle:h,month:i,date:r.getDate()})),e.waterObj=new a(u),e.waterFallContainer=e.el.find(".jContent").append(e.waterObj.makeColHtml()),e.waterFallObj=e.waterFallContainer.find(".waterCol"),c||(c=!0,s.setWaterFalColWidth(o(e.waterFallObj[0]).width())),e.renderItems(t),e},renderItems:function(e){var t=e.items,n=this,i=r.filter(t,function(e){return e.pic_size});n.itemCollection.reset(),n.itemCollection.add(i)},addOne:function(e){var t=this,n=new t.itemView({model:e});o(t.waterFallObj[t.waterObj.getMinIndex()]).append(n.render().el),t.waterObj.pushItem(e.toJSON().pic_size.h)},addAll:function(){var e=this;e.itemCollection.each(function(){e.addOne.apply(e,arguments)})}});n.exports=b})