define(function(e,t,n){var i,r,s,a,o,l=e("$"),c=e("underscore");i=e("backbone"),r=e("../views/todos"),s=e("../collections/todos"),a=e("../common"),o=i.View.extend({el:"#todoapp",statsTemplate:c.template(l("#stats-template").html()),events:{"keypress #new-todo":"createOnEnter","click #clear-completed":"clearCompleted","click #toggle-all":"toggleAllComplete"},initialize:function(){this.allCheckbox=this.$("#toggle-all")[0],this.$input=this.$("#new-todo"),this.$footer=this.$("#footer"),this.$main=this.$("#main"),this.listenTo(s,"add",this.addOne),this.listenTo(s,"reset",this.addAll),this.listenTo(s,"change:completed",this.filterOne),this.listenTo(s,"filter",this.filterAll),this.listenTo(s,"all",this.render),s.fetch()},render:function(){var e=s.completed().length,t=s.remaining().length;s.length?(this.$main.show(),this.$footer.show(),this.$footer.html(this.statsTemplate({completed:e,remaining:t})),this.$("#filters li a").removeClass("selected").filter('[href="#/'+(a.TodoFilter||"")+'"]').addClass("selected")):(this.$main.hide(),this.$footer.hide()),this.allCheckbox.checked=!t},addOne:function(e){var t=new r({model:e});l("#todo-list").append(t.render().el)},addAll:function(){this.$("#todo-list").html(""),s.each(this.addOne,this)},filterOne:function(e){e.trigger("visible")},filterAll:function(){s.each(this.filterOne,this)},newAttributes:function(){return{title:this.$input.val().trim(),order:s.nextOrder(),completed:!1}},createOnEnter:function(e){e.which===a.ENTER_KEY&&this.$input.val().trim()&&(s.create(this.newAttributes()),this.$input.val(""))},clearCompleted:function(){return c.invoke(s.completed(),"destroy"),!1},toggleAllComplete:function(){var e=this.allCheckbox.checked;s.each(function(t){t.save({completed:e})})}}),n.exports=o});